{% extends 'template.html' %}

{% if entries %}
  {% set num_pages = ((entries|length+per_page-1)/per_page)|int %}
{% else %}
  {% set num_pages = 0 %}
{% endif %}

{% block canvas %}
  {% if partial %}
    <div class="col-md-{{ partial }} col-md-offset-{{ ((12-partial)/2)|int }} col-xs-12">
  {% endif %}
  <div class="panel panel-{{ heading_type or 'default' }}" id="panel1">
    <div class="panel-heading">
      <table border=0 style="width:100%;border-spacing:0px 0px;border-collapse:separate">
        <tr>
          <td align="left"><h4>{{ heading|e }}</h4>
          </td>
          <td><h4>&nbsp;</h4>
          </td>
          {% if id_previous or id_next %}
            <td align="right"><span class="btn-group"><button class="btn" id="previous" {% if not id_previous %}disabled{% endif %}><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Previous</button> <button class="btn" id="next" {% if not id_next %}disabled{% endif %}>Next <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button></span>
            </td>
          {% endif %}
        </tr>
      </table></div>
      {% if error or message or not no_panel %}
        <div class="panel-body">
          {% if error %}
            <div class="col-xs-12 alert alert-danger">
              <strong><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> {{ error }}</strong>
            </div>
          {% else %}
            {% block panel_header %}
            {% endblock %}
            {% if message %}
              <div align="left">
                <strong><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> {{ message }}</strong>
              </div>
            {% else %}
              {% block panel %}
              {% endblock %}
            {% endif %}
            {% block panel_footer %}
            {% endblock %}
          {% endif %}
        </div><!-- panel-body -->
      {% endif %}

    {% block list %}
    {% endblock %}

    {% block actions %}
    {% endblock %}
  </div><!-- panel -->

  {% if num_pages > 1 %}
    <div align="center" id="pagetabs">
      <ul class="pagination">
        <li id="previous"><span>&laquo;</span></li>
        {% for page in range(num_pages) %}
          <li id="tab{{ page }}" {% if page == 0 %}class="active"{% endif %}><span>{{ page+1 }}</span></li>
        {% endfor %}
        <li id="next"><span>&raquo;</span></li>
      </ul>
    </div>
  {% endif %}

  {% if partial %}
    </div>
  {% endif %}

  {% if heading2 %}
    {% if partial %}
      <div class="col-md-{{ partial }} col-md-offset-{{ ((12-partial)/2)|int }} col-xs-12">
    {% endif %}

    <div class="panel panel-info" id="panel2" hidden>
      <div class="panel-heading"><h4>{{ heading2|e }}</h4></div>
      <div class="panel-body">
        {% block panel2 %}
        {% endblock %}
      </div><!-- panel-body -->
    </div>

    {% if partial %}
      </div>
    {% endif %}
  {% endif %}

  <script>
    {% if num_pages %}
      // Handle selection of pages
      var page = 0;
      var max_pages = {{ num_pages }};
      function jsShowPage(m,n) {
        $("#page"+m).hide();
        $("#page"+n).show();
        $("#tab"+m).removeClass('active');
        $("#tab"+n).addClass('active');
      }
      $("#pagetabs li").on("click", function(e) {
        var name = $(this).attr('id');
        if (name == "previous") {
          if (page == 0)
            return;
          jsShowPage(page,--page);
        }
        else if (name == "next") {
          if (page == max_pages-1)
            return;
          jsShowPage(page,++page);
        }
        else {
          var n = name.substring(3);
          jsShowPage(page,n);
          page = n;
        }
      });
    {% endif %}
  </script>

  {% block scripts %}
  {% endblock %}
{% endblock %}
